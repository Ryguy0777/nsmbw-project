// d_a_en_boss_castle_iggy.cpp
// NSMBW d_en_boss.text: 0x - 0x

#include <d_system/d_a_player_manager.h>

[[address(0x80B1D450)]]
s32 daEnBossCastleIggy_c_UNDEF_80b1d450() ASM_METHOD(
  // clang-format off
/* 80B1D450 9421FFB0 */  stwu     r1, -80(r1);
/* 80B1D454 7C0802A6 */  mflr     r0;
/* 80B1D458 90010054 */  stw      r0, 84(r1);
/* 80B1D45C 39610050 */  addi     r11, r1, 80;
/* 80B1D460 4B7BFC05 */  bl       UNDEF_802dd064;
/* 80B1D464 3FE080B7 */  lis      r31, UNDEF_80b73ab8@ha;
/* 80B1D468 7C7B1B78 */  mr       r27, r3;
/* 80B1D46C 3BFF3AB8 */  addi     r31, r31, UNDEF_80b73ab8@l;

                         // Find first active player
                         li       r28, 0;
L_daEnBossCastleIggy_c_UNDEF_80b1d450_FindActivePlayerLoop:;
/* 80B1D470          */  mr       r3, r28;
/* 80B1D474 4B54248D */  bl       getPlayer__9daPyMng_cFi;
                         cmpwi    r3, 0;
                         addi     r28, r28, 1;
                         bne-     L_daEnBossCastleIggy_c_UNDEF_80b1d450_FindActivePlayerEnd;

                         cmpwi    r28, PLAYER_COUNT;
                         blt+     L_daEnBossCastleIggy_c_UNDEF_80b1d450_FindActivePlayerLoop;

L_daEnBossCastleIggy_c_UNDEF_80b1d450_FindActivePlayerEnd:;
/* 80B1D478 C00300B4 */  lfs      f0, 180(r3);
/* 80B1D47C 38000000 */  li       r0, 0;
/* 80B1D480 C02300B0 */  lfs      f1, 176(r3);
/* 80B1D484 3BC10014 */  addi     r30, r1, 20;
/* 80B1D488 C04300AC */  lfs      f2, 172(r3);
/* 80B1D48C 3BA10008 */  addi     r29, r1, 8;
/* 80B1D490 D041002C */  stfs     f2, 44(r1);
/* 80B1D498 D0210030 */  stfs     f1, 48(r1);
/* 80B1D49C D0010034 */  stfs     f0, 52(r1);
/* 80B1D4A0 901B0764 */  stw      r0, 1892(r27);
UNDEF_80b1d4a4:;
/* 80B1D4A4 7F83E378 */  mr       r3, r28;
/* 80B1D4A8 4B542459 */  bl       getPlayer__9daPyMng_cFi;
/* 80B1D4AC 2C030000 */  cmpwi    r3, 0;
/* 80B1D4B0 41820098 */  beq-     UNDEF_80b1d548;
/* 80B1D4B4 C09B00B0 */  lfs      f4, 176(r27);
/* 80B1D4B8 C0010030 */  lfs      f0, 48(r1);
/* 80B1D4BC C06300B0 */  lfs      f3, 176(r3);
/* 80B1D4C0 ECE40028 */  fsubs    f7, f4, f0;
/* 80B1D4C4 C05B00AC */  lfs      f2, 172(r27);
/* 80B1D4C8 ECA41828 */  fsubs    f5, f4, f3;
/* 80B1D4CC C02300AC */  lfs      f1, 172(r3);
/* 80B1D4D0 C001002C */  lfs      f0, 44(r1);
/* 80B1D4D4 ECC20828 */  fsubs    f6, f2, f1;
/* 80B1D4D8 ED020028 */  fsubs    f8, f2, f0;
/* 80B1D4DC D0A10018 */  stfs     f5, 24(r1);
/* 80B1D4E0 C09B00B4 */  lfs      f4, 180(r27);
/* 80B1D4E4 D0C10014 */  stfs     f6, 20(r1);
/* 80B1D4E8 C04300B4 */  lfs      f2, 180(r3);
/* 80B1D4EC C0010034 */  lfs      f0, 52(r1);
/* 80B1D4F0 E0DE0000 */  .long    0xE0DE0000; // psq_l    f6, 0(r30), 0, 0;
/* 80B1D4F4 ECA41028 */  fsubs    f5, f4, f2;
/* 80B1D4F8 EC040028 */  fsubs    f0, f4, f0;
/* 80B1D4FC D1010008 */  stfs     f8, 8(r1);
/* 80B1D500 10C601B2 */  .long    0x10C601B2; // ps_mul   f6, f6, f6;
/* 80B1D504 D0E1000C */  stfs     f7, 12(r1);
/* 80B1D508 E0FD0000 */  .long    0xE0FD0000; // psq_l    f7, 0(r29), 0, 0;
/* 80B1D50C 1085317A */  .long    0x1085317A; // ps_madd  f4, f5, f5, f6;
/* 80B1D510 D0010010 */  stfs     f0, 16(r1);
/* 80B1D514 10E701F2 */  .long    0x10E701F2; // ps_mul   f7, f7, f7;
/* 80B1D518 10843194 */  .long    0x10843194; // ps_sum0  f4, f4, f6, f6;
/* 80B1D51C D0A1001C */  stfs     f5, 28(r1);
/* 80B1D520 1000383A */  .long    0x1000383A; // ps_madd  f0, f0, f0, f7;
/* 80B1D524 100039D4 */  .long    0x100039D4; // ps_sum0  f0, f0, f7, f7;
/* 80B1D528 FC040040 */  fcmpo    cr0, f4, f0;
/* 80B1D52C 7C000026 */  mfcr     r0;
/* 80B1D530 54000FFF */  srwi.    r0, r0, 31;
/* 80B1D534 41820014 */  beq-     UNDEF_80b1d548;
/* 80B1D538 D021002C */  stfs     f1, 44(r1);
/* 80B1D53C D0610030 */  stfs     f3, 48(r1);
/* 80B1D540 D0410034 */  stfs     f2, 52(r1);
/* 80B1D544 939B0764 */  stw      r28, 1892(r27);
UNDEF_80b1d548:;
/* 80B1D548 3B9C0001 */  addi     r28, r28, 1;
/* 80B1D54C 2C1C0004 */  cmpwi    r28, PLAYER_COUNT;
/* 80B1D550 4180FF54 */  blt+     UNDEF_80b1d4a4;
/* 80B1D554 C0210030 */  lfs      f1, 48(r1);
/* 80B1D558 C01B00B0 */  lfs      f0, 176(r27);
/* 80B1D55C 807B0E84 */  lwz      r3, 3716(r27);
/* 80B1D560 EC610028 */  fsubs    f3, f1, f0;
/* 80B1D564 C041002C */  lfs      f2, 44(r1);
/* 80B1D568 C01B00AC */  lfs      f0, 172(r27);
/* 80B1D56C 800306DC */  lwz      r0, 1756(r3);
/* 80B1D570 EC420028 */  fsubs    f2, f2, f0;
/* 80B1D574 C03F0060 */  lfs      f1, 96(r31);
/* 80B1D578 2C000000 */  cmpwi    r0, 0;
/* 80B1D57C D0610024 */  stfs     f3, 36(r1);
/* 80B1D580 D0210028 */  stfs     f1, 40(r1);
/* 80B1D584 D0410020 */  stfs     f2, 32(r1);
/* 80B1D588 40820068 */  bne-     UNDEF_80b1d5f0;
/* 80B1D58C 806306E0 */  lwz      r3, 1760(r3);
/* 80B1D590 3803FFFE */  subi     r0, r3, 2;
/* 80B1D594 28000001 */  cmplwi   r0, 1;
/* 80B1D598 41810020 */  bgt-     UNDEF_80b1d5b8;
/* 80B1D59C C01F0088 */  lfs      f0, 136(r31);
/* 80B1D5A0 FC030040 */  fcmpo    cr0, f3, f0;
/* 80B1D5A4 408100B0 */  ble-     UNDEF_80b1d654;
/* 80B1D5A8 FC020840 */  fcmpo    cr0, f2, f1;
/* 80B1D5AC 408000A8 */  bge-     UNDEF_80b1d654;
/* 80B1D5B0 38600001 */  li       r3, 1;
/* 80B1D5B4 480000A4 */  b        UNDEF_80b1d658;
UNDEF_80b1d5b8:;
/* 80B1D5B8 2C030000 */  cmpwi    r3, 0;
/* 80B1D5BC 4182000C */  beq-     UNDEF_80b1d5c8;
/* 80B1D5C0 2C030005 */  cmpwi    r3, 5;
/* 80B1D5C4 40820090 */  bne-     UNDEF_80b1d654;
UNDEF_80b1d5c8:;
/* 80B1D5C8 C0210024 */  lfs      f1, 36(r1);
/* 80B1D5CC C01F008C */  lfs      f0, 140(r31);
/* 80B1D5D0 FC010040 */  fcmpo    cr0, f1, f0;
/* 80B1D5D4 40800080 */  bge-     UNDEF_80b1d654;
/* 80B1D5D8 C0210020 */  lfs      f1, 32(r1);
/* 80B1D5DC C01F0060 */  lfs      f0, 96(r31);
/* 80B1D5E0 FC010040 */  fcmpo    cr0, f1, f0;
/* 80B1D5E4 40810070 */  ble-     UNDEF_80b1d654;
/* 80B1D5E8 38600001 */  li       r3, 1;
/* 80B1D5EC 4800006C */  b        UNDEF_80b1d658;
UNDEF_80b1d5f0:;
/* 80B1D5F0 806306E0 */  lwz      r3, 1760(r3);
/* 80B1D5F4 2C030000 */  cmpwi    r3, 0;
/* 80B1D5F8 4182000C */  beq-     UNDEF_80b1d604;
/* 80B1D5FC 2C030005 */  cmpwi    r3, 5;
/* 80B1D600 4082002C */  bne-     UNDEF_80b1d62c;
UNDEF_80b1d604:;
/* 80B1D604 C0210024 */  lfs      f1, 36(r1);
/* 80B1D608 C01F0088 */  lfs      f0, 136(r31);
/* 80B1D60C FC010040 */  fcmpo    cr0, f1, f0;
/* 80B1D610 40810044 */  ble-     UNDEF_80b1d654;
/* 80B1D614 C0210020 */  lfs      f1, 32(r1);
/* 80B1D618 C01F0060 */  lfs      f0, 96(r31);
/* 80B1D61C FC010040 */  fcmpo    cr0, f1, f0;
/* 80B1D620 40810034 */  ble-     UNDEF_80b1d654;
/* 80B1D624 38600001 */  li       r3, 1;
/* 80B1D628 48000030 */  b        UNDEF_80b1d658;
UNDEF_80b1d62c:;
/* 80B1D62C 3803FFFE */  subi     r0, r3, 2;
/* 80B1D630 28000001 */  cmplwi   r0, 1;
/* 80B1D634 41810020 */  bgt-     UNDEF_80b1d654;
/* 80B1D638 C01F008C */  lfs      f0, 140(r31);
/* 80B1D63C FC030040 */  fcmpo    cr0, f3, f0;
/* 80B1D640 40800014 */  bge-     UNDEF_80b1d654;
/* 80B1D644 FC020840 */  fcmpo    cr0, f2, f1;
/* 80B1D648 4080000C */  bge-     UNDEF_80b1d654;
/* 80B1D64C 38600001 */  li       r3, 1;
/* 80B1D650 48000008 */  b        UNDEF_80b1d658;
UNDEF_80b1d654:;
/* 80B1D654 38600000 */  li       r3, 0;
UNDEF_80b1d658:;
/* 80B1D658 39610050 */  addi     r11, r1, 80;
/* 80B1D65C 4B7BFA55 */  bl       UNDEF_802dd0b0;
/* 80B1D660 80010054 */  lwz      r0, 84(r1);
/* 80B1D664 7C0803A6 */  mtlr     r0;
/* 80B1D668 38210050 */  addi     r1, r1, 80;
/* 80B1D66C 4E800020 */  blr;
  // clang-format on
);